<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¸ªè‚¡å®šæŠ•è®¡ç®—å™¨</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        padding: 16px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: #2c3e50;
        padding: 20px 0;
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 24px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .header .subtitle {
        font-size: 14px;
        color: #7f8c8d;
      }

      .card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #2c3e50;
        font-size: 15px;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #dfe6e9;
        border-radius: 6px;
        font-size: 16px;
        transition: border-color 0.3s;
        background: #fff;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #5f8dd3;
      }

      .inline-group {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .inline-group input {
        width: 120px;
      }

      .inline-group select {
        width: 200px;
      }

      .btn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary {
        background: #5f8dd3;
        color: white;
      }

      .btn-primary:hover {
        background: #4a7bc2;
      }

      .btn-primary:active {
        transform: scale(0.98);
      }

      .result-section {
        display: none;
      }

      .result-header {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #ecf0f1;
        color: #2c3e50;
      }

      .main-result {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        color: #2c3e50;
        padding: 24px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 20px;
      }

      .main-result .stock-info {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e9ecef;
      }

      .main-result .amount {
        font-size: 42px;
        font-weight: 600;
        margin: 16px 0;
        color: #5f8dd3;
      }

      .main-result .shares-info {
        font-size: 18px;
        margin-top: 12px;
        font-weight: 500;
        color: #34495e;
      }

      .main-result .strategy {
        font-size: 14px;
        margin-top: 12px;
        padding: 8px;
        background: #e8f4f8;
        border-radius: 4px;
        color: #5f8dd3;
      }

      .main-result .theory-amount {
        font-size: 13px;
        margin-top: 8px;
        color: #95a5a6;
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }

      .info-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }

      .info-item .label {
        font-size: 12px;
        color: #7f8c8d;
        margin-bottom: 4px;
      }

      .info-item .value {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
      }

      .deviation {
        text-align: center;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 20px;
        font-weight: 500;
      }

      .deviation.positive {
        background: #fff3e0;
        color: #e67e22;
      }

      .deviation.negative {
        background: #e8f5e9;
        color: #27ae60;
      }

      .tips {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 6px;
        margin-top: 20px;
        border-left: 3px solid #5f8dd3;
      }

      .tips .tips-title {
        font-weight: 600;
        margin-bottom: 8px;
        color: #2c3e50;
      }

      .tips ul {
        margin-left: 20px;
        color: #555;
      }

      .tips li {
        margin-bottom: 4px;
        font-size: 14px;
        color: #5f6c7d;
      }

      .btn-secondary {
        background: #95a5a6;
        color: white;
        margin-top: 12px;
      }

      .btn-secondary:hover {
        background: #7f8c8d;
      }

      .warning-box {
        background: #fff9f0;
        border: 1px solid #ffd89b;
        padding: 16px;
        border-radius: 6px;
        margin-bottom: 20px;
      }

      .warning-box .warning-title {
        font-weight: 600;
        color: #d68910;
        margin-bottom: 8px;
        font-size: 15px;
      }

      .warning-box ul {
        margin-left: 20px;
        color: #9a7b4f;
        font-size: 14px;
      }

      .base-amount-section {
        background: #f0f9ff;
        padding: 16px;
        border-radius: 6px;
        margin-bottom: 20px;
        border: 1px solid #bae6fd;
      }

      .base-amount-section .title {
        font-weight: 600;
        margin-bottom: 12px;
        color: #2c3e50;
      }

      .base-amount-input {
        width: 150px;
        padding: 10px;
        border: 1px solid #5f8dd3;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
      }

      .min-hands-section {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 6px;
        margin-bottom: 20px;
        border: 1px solid #dee2e6;
      }

      .min-hands-section .title {
        font-weight: 600;
        margin-bottom: 12px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .help-icon {
        display: inline-block;
        width: 18px;
        height: 18px;
        background: #5f8dd3;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 18px;
        font-size: 12px;
        cursor: help;
      }

      .example-box {
        background: white;
        padding: 12px;
        border-radius: 4px;
        margin-top: 8px;
        font-size: 12px;
        color: #5f6c7d;
        border: 1px solid #e9ecef;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“Š ä¸ªè‚¡å®šæŠ•è®¡ç®—å™¨</h1>
        <div class="subtitle">åŸºäºMA30å‡çº¿çš„æ™ºèƒ½å®šæŠ•ç­–ç•¥</div>
      </div>

      <div class="card">
        <div class="warning-box">
          <div class="warning-title">âš ï¸ ä¸ªè‚¡å®šæŠ•é£é™©æç¤º</div>
          <ul>
            <li>ä¸ªè‚¡é£é™©è¿œé«˜äºæŒ‡æ•°ETFï¼Œè¯·è°¨æ…æ“ä½œ</li>
            <li>å»ºè®®ä»…ç”¨é—²ç½®èµ„é‡‘ï¼Œä¸è¶…è¿‡æ€»èµ„äº§çš„20%</li>
            <li>é€‰æ‹©åŸºæœ¬é¢è‰¯å¥½ã€è¡Œä¸šé¾™å¤´çš„ä¼˜è´¨è‚¡ç¥¨</li>
          </ul>
        </div>

        <div class="base-amount-section">
          <div class="title">ğŸ’° åŸºå‡†å®šæŠ•é‡‘é¢ï¼ˆ1å€æ—¶ï¼‰</div>
          <input
            type="number"
            id="base-amount"
            class="base-amount-input"
            value="10000"
            step="1000"
            onchange="saveSettings()"
          />
          <span style="font-size: 13px; color: #7f8c8d; margin-left: 8px"
            >å…ƒ/å‘¨</span
          >
        </div>

        <div class="min-hands-section">
          <div class="title">
            ğŸ¯ äº¤æ˜“å•ä½
            <span class="help-icon" title="æŸäº›è‚¡ç¥¨å¿…é¡»æŒ‰Næ‰‹çš„æ•´æ•°å€ä¹°å…¥"
              >?</span
            >
          </div>
          <div class="inline-group">
            <span style="color: #5f6c7d">å¿…é¡»ä¹°</span>
            <select id="min-hands" onchange="saveSettings()">
              <option value="1">1æ‰‹ï¼ˆ100è‚¡ï¼‰çš„æ•´æ•°å€</option>
              <option value="2">2æ‰‹ï¼ˆ200è‚¡ï¼‰çš„æ•´æ•°å€</option>
              <option value="3">3æ‰‹ï¼ˆ300è‚¡ï¼‰çš„æ•´æ•°å€</option>
              <option value="4">4æ‰‹ï¼ˆ400è‚¡ï¼‰çš„æ•´æ•°å€</option>
              <option value="5">5æ‰‹ï¼ˆ500è‚¡ï¼‰çš„æ•´æ•°å€</option>
              <option value="10">10æ‰‹ï¼ˆ1000è‚¡ï¼‰çš„æ•´æ•°å€</option>
            </select>
          </div>
          <div class="example-box">
            ğŸ’¡
            ç¤ºä¾‹ï¼šé€‰æ‹©"2æ‰‹çš„æ•´æ•°å€"ï¼Œåˆ™åªèƒ½ä¹°200ã€400ã€600ã€800è‚¡ï¼ˆä¸èƒ½ä¹°100ã€300ã€500è‚¡ï¼‰
          </div>
        </div>

        <div class="form-group">
          <label for="stock-name">ğŸ“Œ è‚¡ç¥¨åç§°/ä»£ç ï¼ˆå¯é€‰ï¼‰</label>
          <input
            type="text"
            id="stock-name"
            placeholder="ä¾‹å¦‚: è´µå·èŒ…å° / 600519"
          />
        </div>

        <div class="form-group">
          <label for="ma30">ğŸ“Š å½“å‰MA30å€¼</label>
          <input
            type="number"
            id="ma30"
            step="0.01"
            placeholder="ä¾‹å¦‚: 32.00"
          />
        </div>

        <div class="form-group">
          <label for="current-price">ğŸ’° å½“å‰è‚¡ä»·</label>
          <input
            type="number"
            id="current-price"
            step="0.01"
            placeholder="ä¾‹å¦‚: 30.00"
          />
        </div>

        <button class="btn btn-primary" onclick="calculate()">
          ğŸ’¡ è®¡ç®—æœ¬å‘¨å®šæŠ•é‡‘é¢
        </button>
      </div>

      <div class="card result-section" id="result-section">
        <div class="result-header">ğŸ“ˆ æœ¬å‘¨å®šæŠ•æ–¹æ¡ˆ</div>

        <div class="main-result">
          <div class="stock-info" id="stock-info">-</div>

          <div style="font-size: 14px; color: #7f8c8d">æœ¬å‘¨åº”ä¹°å…¥</div>
          <div class="shares-info" id="shares-display">-</div>

          <div class="amount" id="actual-amount">-</div>

          <div class="theory-amount" id="theory-amount">-</div>
          <div class="strategy" id="strategy-name">-</div>
        </div>

        <div class="info-grid">
          <div class="info-item">
            <div class="label">MA30å€¼</div>
            <div class="value" id="display-ma30">-</div>
          </div>
          <div class="info-item">
            <div class="label">å½“å‰è‚¡ä»·</div>
            <div class="value" id="display-price">-</div>
          </div>
        </div>

        <div class="deviation" id="deviation-display"></div>

        <div class="tips">
          <div class="tips-title">ğŸ’¡ æ“ä½œå»ºè®®</div>
          <ul>
            <li>æ¯å‘¨ä¸‰ä¸‹åˆ2-3ç‚¹ä¹‹é—´æ‰§è¡Œä¹°å…¥</li>
            <li>ä½¿ç”¨é™ä»·å•ï¼ŒæŒ‰ç…§è®¡ç®—çš„è‚¡æ•°ä¸‹å•</li>
            <li>å¦‚å½“æ—¥åœç‰Œæˆ–æ¶¨åœï¼Œé¡ºå»¶è‡³ä¸‹ä¸€äº¤æ˜“æ—¥</li>
            <li>é•¿æœŸåšæŒï¼Œä¸è¢«çŸ­æœŸæ³¢åŠ¨å½±å“</li>
          </ul>
        </div>

        <button class="btn btn-secondary" onclick="saveRecord()">
          ğŸ’¾ ä¿å­˜æœ¬æ¬¡è®°å½•
        </button>
      </div>
    </div>

    <script>
      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        loadSettings();
      });

      // ä¿å­˜è®¾ç½®
      function saveSettings() {
        const baseAmount = document.getElementById("base-amount").value;
        const minHands = document.getElementById("min-hands").value;

        localStorage.setItem("baseAmount", baseAmount);
        localStorage.setItem("minHands", minHands);
      }

      // åŠ è½½è®¾ç½®
      function loadSettings() {
        const baseAmount = localStorage.getItem("baseAmount") || "10000";
        const minHands = localStorage.getItem("minHands") || "1";

        document.getElementById("base-amount").value = baseAmount;
        document.getElementById("min-hands").value = minHands;
      }

      // è®¡ç®—å®é™…å¯ä¹°ä»½é¢å’Œé‡‘é¢ï¼ˆæŒ‰äº¤æ˜“å•ä½çš„æ•´æ•°å€ï¼‰
      function calculateActualShares(theoreticalAmount, price, minHands) {
        const baseUnit = 100; // 1æ‰‹ = 100è‚¡
        const tradingUnit = minHands * baseUnit; // äº¤æ˜“å•ä½ï¼ˆå¿…é¡»æ˜¯è¿™ä¸ªæ•°çš„æ•´æ•°å€ï¼‰

        // è®¡ç®—ç†è®ºå¯ä¹°ä»½é¢
        const theoreticalShares = Math.floor(theoreticalAmount / price);

        // å‘ä¸‹å–æ•´åˆ°äº¤æ˜“å•ä½çš„æ•´æ•°å€
        let actualShares =
          Math.floor(theoreticalShares / tradingUnit) * tradingUnit;

        // å¦‚æœè®¡ç®—ç»“æœä¸º0ï¼Œåˆ™è‡³å°‘ä¹°1ä¸ªäº¤æ˜“å•ä½
        if (actualShares === 0) {
          actualShares = tradingUnit;
        }

        // è®¡ç®—å®é™…é‡‘é¢
        const actualAmount = actualShares * price;

        // è®¡ç®—æ‰‹æ•°
        const hands = actualShares / baseUnit;

        return {
          shares: actualShares,
          hands: hands,
          amount: actualAmount,
          isMinPurchase: theoreticalShares < tradingUnit,
        };
      }

      // è®¡ç®—å®šæŠ•é‡‘é¢
      function calculate() {
        const stockName =
          document.getElementById("stock-name").value || "è¯¥è‚¡ç¥¨";
        const ma30 = parseFloat(document.getElementById("ma30").value);
        const currentPrice = parseFloat(
          document.getElementById("current-price").value
        );
        const baseAmount = parseFloat(
          document.getElementById("base-amount").value
        );
        const minHands = parseInt(document.getElementById("min-hands").value);

        // éªŒè¯è¾“å…¥
        if (isNaN(ma30) || isNaN(currentPrice)) {
          alert("è¯·è¾“å…¥æœ‰æ•ˆçš„MA30å€¼å’Œè‚¡ä»·ï¼");
          return;
        }

        if (isNaN(baseAmount) || baseAmount <= 0) {
          alert("è¯·è®¾ç½®æœ‰æ•ˆçš„åŸºå‡†å®šæŠ•é‡‘é¢ï¼");
          return;
        }

        // è®¡ç®—ä»·æ ¼åç¦»åº¦
        const deviation = ((currentPrice - ma30) / ma30) * 100;

        // æ ¹æ®åç¦»åº¦ç¡®å®šæŠ•èµ„å€æ•°å’Œç­–ç•¥
        let multiplier, strategyName;

        if (deviation > 5) {
          multiplier = 0.5;
          strategyName = "é«˜ä½å‡ç ï¼ˆ0.5å€ï¼‰";
        } else if (deviation > 2) {
          multiplier = 0.75;
          strategyName = "ç•¥é«˜å‡ç ï¼ˆ0.75å€ï¼‰";
        } else if (deviation >= -2) {
          multiplier = 1.0;
          strategyName = "åŸºå‡†æŠ•å…¥ï¼ˆ1å€ï¼‰";
        } else if (deviation >= -5) {
          multiplier = 1.5;
          strategyName = "ç•¥ä½åŠ ç ï¼ˆ1.5å€ï¼‰";
        } else if (deviation >= -10) {
          multiplier = 2.0;
          strategyName = "ä¸­åº¦åŠ ç ï¼ˆ2å€ï¼‰";
        } else {
          multiplier = 3.0;
          strategyName = "é‡åº¦åŠ ç ï¼ˆ3å€ï¼‰";
        }

        // è®¡ç®—ç†è®ºæŠ•å…¥é‡‘é¢
        const theoreticalAmount = baseAmount * multiplier;

        // è®¡ç®—å®é™…å¯ä¹°ä»½é¢å’Œé‡‘é¢
        const actual = calculateActualShares(
          theoreticalAmount,
          currentPrice,
          minHands
        );

        // æ˜¾ç¤ºç»“æœ
        document.getElementById("result-section").style.display = "block";
        document.getElementById(
          "stock-info"
        ).textContent = `${stockName} @ ${currentPrice.toFixed(2)}å…ƒ`;

        // æ˜¾ç¤ºè‚¡æ•°
        let sharesDisplay = `${actual.shares}è‚¡ï¼ˆ${actual.hands}æ‰‹ï¼‰`;
        if (actual.isMinPurchase && minHands > 1) {
          sharesDisplay += ` ğŸ”’`;
        }

        document.getElementById("shares-display").textContent = sharesDisplay;
        document.getElementById("actual-amount").textContent =
          actual.amount.toFixed(2) + "å…ƒ";

        // æ˜¾ç¤ºç†è®ºé‡‘é¢ï¼ˆå¦‚æœä¸å®é™…é‡‘é¢ä¸åŒï¼‰
        const theoryDisplay = document.getElementById("theory-amount");
        if (Math.abs(actual.amount - theoreticalAmount) > 1) {
          theoryDisplay.textContent = `ç†è®ºå»ºè®®ï¼š${theoreticalAmount.toFixed(
            0
          )}å…ƒ`;
          if (actual.isMinPurchase && minHands > 1) {
            theoryDisplay.textContent += ` (å› äº¤æ˜“å•ä½é™åˆ¶å·²è°ƒæ•´)`;
          }
        } else {
          theoryDisplay.textContent = "";
        }

        document.getElementById("strategy-name").textContent = strategyName;
        document.getElementById("display-ma30").textContent = ma30.toFixed(2);
        document.getElementById("display-price").textContent =
          currentPrice.toFixed(2);

        // æ˜¾ç¤ºåç¦»åº¦
        const deviationDisplay = document.getElementById("deviation-display");
        deviationDisplay.textContent = `ä»·æ ¼åç¦»MA30: ${deviation.toFixed(2)}%`;
        deviationDisplay.className =
          "deviation " + (deviation >= 0 ? "positive" : "negative");

        // æ»šåŠ¨åˆ°ç»“æœ
        document
          .getElementById("result-section")
          .scrollIntoView({ behavior: "smooth" });
      }

      // ä¿å­˜è®°å½•
      function saveRecord() {
        const stockName =
          document.getElementById("stock-name").value || "æœªå‘½å";
        const ma30 = document.getElementById("display-ma30").textContent;
        const price = document.getElementById("display-price").textContent;
        const shares = document.getElementById("shares-display").textContent;
        const amount = document.getElementById("actual-amount").textContent;
        const deviation =
          document.getElementById("deviation-display").textContent;

        const record = {
          date: new Date().toLocaleDateString(),
          stock: stockName,
          ma30: ma30,
          price: price,
          shares: shares,
          amount: amount,
          deviation: deviation.match(/-?\d+\.\d+/)[0] + "%",
        };

        let history = JSON.parse(localStorage.getItem("stockHistory") || "[]");
        history.unshift(record);

        if (history.length > 50) {
          history = history.slice(0, 50);
        }

        localStorage.setItem("stockHistory", JSON.stringify(history));
        alert("âœ… å·²ä¿å­˜åˆ°å†å²è®°å½•");
      }
    </script>
  </body>
</html>
